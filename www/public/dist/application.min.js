"use strict";var ApplicationConfiguration=function(){var a="dijitechio",b=["ngResource","ngCookies","ngAnimate","ngTouch","ngSanitize","ui.router","ui.bootstrap","ui.utils"],c=function(b,c){angular.module(b,c||[]),angular.module(a).requires.push(b)};return{applicationModuleName:a,applicationModuleVendorDependencies:b,registerModule:c}}();angular.module(ApplicationConfiguration.applicationModuleName,ApplicationConfiguration.applicationModuleVendorDependencies),angular.module(ApplicationConfiguration.applicationModuleName).config(["$locationProvider",function(a){a.hashPrefix("!")}]),angular.element(document).ready(function(){"#_=_"===window.location.hash&&(window.location.hash="#!"),angular.bootstrap(document,[ApplicationConfiguration.applicationModuleName])}),ApplicationConfiguration.registerModule("core"),ApplicationConfiguration.registerModule("customers"),ApplicationConfiguration.registerModule("users"),angular.module("core").config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/"),a.state("home",{url:"/",templateUrl:"modules/core/views/home.client.view.html"})}]),angular.module("core").controller("HeaderController",["$scope","Authentication","Menus",function(a,b,c){a.authentication=b,a.isCollapsed=!1,a.menu=c.getMenu("topbar"),a.toggleCollapsibleMenu=function(){a.isCollapsed=!a.isCollapsed},a.$on("$stateChangeSuccess",function(){a.isCollapsed=!1})}]),angular.module("core").controller("HomeController",["$scope","Authentication",function(a,b){a.authentication=b,a.alerts=[{icon:"glyphicon-user",color:"btn-success",total:"20,408",description:"TOTAL CUSTOMERS"},{icon:"glyphicon-calendar",color:"btn-primary",total:"5345",description:"Upcoming Events"},{icon:"glyphicon-edit",color:"btn-success",total:"117",description:"NEWEST CUSTOMERS"},{icon:"glyphicon-record",color:"btn-info",total:"9999999",description:"EMAILS SENT"},{icon:"glyphicon-eye-open",color:"btn-warning",total:"20",description:"FOLLOW UPS REQUIRED"},{icon:"glyphicon-flag",color:"btn-danger",total:"23",description:"TO-DOS"}]}]),angular.module("core").service("Menus",[function(){this.defaultRoles=["*"],this.menus={};var a=function(a){if(!a)return this.isPublic;if(~this.roles.indexOf("*"))return!0;for(var b in a.roles)for(var c in this.roles)if(this.roles[c]===a.roles[b])return!0;return!1};this.validateMenuExistance=function(a){if(a&&a.length){if(this.menus[a])return!0;throw new Error("Menu does not exists")}throw new Error("MenuId was not provided")},this.getMenu=function(a){return this.validateMenuExistance(a),this.menus[a]},this.addMenu=function(b,c,d){return this.menus[b]={isPublic:c||!1,roles:d||this.defaultRoles,items:[],shouldRender:a},this.menus[b]},this.removeMenu=function(a){this.validateMenuExistance(a),delete this.menus[a]},this.addMenuItem=function(b,c,d,e,f,g,h,i){return this.validateMenuExistance(b),this.menus[b].items.push({title:c,link:d,menuItemType:e||"item",menuItemClass:e,uiRoute:f||"/"+d,isPublic:null===g||"undefined"==typeof g?this.menus[b].isPublic:g,roles:null===h||"undefined"==typeof h?this.menus[b].roles:h,position:i||0,items:[],shouldRender:a}),this.menus[b]},this.addSubMenuItem=function(b,c,d,e,f,g,h,i){this.validateMenuExistance(b);for(var j in this.menus[b].items)this.menus[b].items[j].link===c&&this.menus[b].items[j].items.push({title:d,link:e,uiRoute:f||"/"+e,isPublic:null===g||"undefined"==typeof g?this.menus[b].items[j].isPublic:g,roles:null===h||"undefined"==typeof h?this.menus[b].items[j].roles:h,position:i||0,shouldRender:a});return this.menus[b]},this.removeMenuItem=function(a,b){this.validateMenuExistance(a);for(var c in this.menus[a].items)this.menus[a].items[c].link===b&&this.menus[a].items.splice(c,1);return this.menus[a]},this.removeSubMenuItem=function(a,b){this.validateMenuExistance(a);for(var c in this.menus[a].items)for(var d in this.menus[a].items[c].items)this.menus[a].items[c].items[d].link===b&&this.menus[a].items[c].items.splice(d,1);return this.menus[a]},this.addMenu("topbar")}]),angular.module("customers").run(["Menus",function(a){a.addMenuItem("topbar","Customers","customers","dropdown","/customers(/create)?"),a.addSubMenuItem("topbar","customers","List Customers","customers"),a.addSubMenuItem("topbar","customers","New Customer","customers/create")}]),angular.module("customers").config(["$stateProvider",function(a){a.state("listCustomers",{url:"/customers",templateUrl:"modules/customers/views/list-customers.client.view.html"}).state("createCustomer",{url:"/customers/create",templateUrl:"modules/customers/views/create-customer.client.view.html"}).state("viewCustomer",{url:"/customers/:customerId",templateUrl:"modules/customers/views/view-customer.client.view.html"}).state("editCustomer",{url:"/customers/:customerId/edit",templateUrl:"modules/customers/views/edit-customer.client.view.html"})}]),angular.module("customers").controller("CustomersController",["$scope","$stateParams","$location","Authentication","Customers",function(a,b,c,d,e){a.authentication=d,a.create=function(){var b=new e({firstName:this.firstName,lastName:this.lastName,city:this.city,country:this.country,industry:this.industry,email:this.email,phone:this.phone,referred:this.referred,channel:this.channel});b.$save(function(b){c.path("customers/"+b._id),a.firstName="",a.lastName="",a.city="",a.country="",a.industry="",a.email="",a.phone="",a.referred="",a.channel=""},function(b){a.error=b.data.message})},a.remove=function(b){if(b){b.$remove();for(var d in a.customers)a.customers[d]===b&&a.customers.splice(d,1)}else a.customer.$remove(function(){c.path("customers")})},a.update=function(){var b=a.customer;b.$update(function(){c.path("customers/"+b._id)},function(b){a.error=b.data.message})},a.find=function(){a.customers=e.query()},a.findOne=function(){a.customer=e.get({customerId:b.customerId})},a.customerFields=[{field:"firstName",fieldName:"First Name",fieldValue:"firstName",icon:"glyphicon glyphicon-user",type:"text"},{field:"lastName",fieldName:"Last Name",fieldValue:"lastName",icon:"glyphicon glyphicon-user",type:"text"},{field:"city",fieldName:"City",fieldValue:"city",icon:"glyphicon glyphicon-user",type:"text"},{field:"country",fieldName:"Country",fieldValue:"country",icon:"glyphicon glyphicon-user",type:"text"},{field:"industry",fieldName:"Industry",fieldValue:"industry",icon:"glyphicon glyphicon-user",type:"text"},{field:"email",fieldName:"Email",fieldValue:"email",icon:"glyphicon glyphicon-user",type:"text"},{field:"phone",fieldName:"Phone",fieldValue:"phone",icon:"glyphicon glyphicon-user",type:"text"},{field:"referred",fieldName:"Referred",fieldValue:"referred",icon:"glyphicon glyphicon-user",type:"checkbox"},{field:"channel",fieldName:"Channel",fieldValue:"channel",icon:"glyphicon glyphicon-user",type:"text"}]}]),angular.module("customers").factory("Customers",["$resource",function(a){return a("customers/:customerId",{customerId:"@_id"},{update:{method:"PUT"}})}]),angular.module("users").config(["$httpProvider",function(a){a.interceptors.push(["$q","$location","Authentication",function(a,b,c){return{responseError:function(d){switch(d.status){case 401:c.user=null,b.path("signin");break;case 403:}return a.reject(d)}}}])}]),angular.module("users").config(["$stateProvider",function(a){a.state("profile",{url:"/settings/profile",templateUrl:"modules/users/views/settings/edit-profile.client.view.html"}).state("password",{url:"/settings/password",templateUrl:"modules/users/views/settings/change-password.client.view.html"}).state("accounts",{url:"/settings/accounts",templateUrl:"modules/users/views/settings/social-accounts.client.view.html"}).state("signup",{url:"/signup",templateUrl:"modules/users/views/authentication/signup.client.view.html"}).state("signin",{url:"/signin",templateUrl:"modules/users/views/authentication/signin.client.view.html"}).state("forgot",{url:"/password/forgot",templateUrl:"modules/users/views/password/forgot-password.client.view.html"}).state("reset-invalid",{url:"/password/reset/invalid",templateUrl:"modules/users/views/password/reset-password-invalid.client.view.html"}).state("reset-success",{url:"/password/reset/success",templateUrl:"modules/users/views/password/reset-password-success.client.view.html"}).state("reset",{url:"/password/reset/:token",templateUrl:"modules/users/views/password/reset-password.client.view.html"})}]),angular.module("users").controller("AuthenticationController",["$scope","$http","$location","Authentication",function(a,b,c,d){a.authentication=d,a.authentication.user&&c.path("/"),a.signup=function(){b.post("/auth/signup",a.credentials).success(function(b){a.authentication.user=b,c.path("/")}).error(function(b){a.error=b.message})},a.signin=function(){b.post("/auth/signin",a.credentials).success(function(b){a.authentication.user=b,c.path("/")}).error(function(b){a.error=b.message})}}]),angular.module("users").controller("PasswordController",["$scope","$stateParams","$http","$location","Authentication",function(a,b,c,d,e){a.authentication=e,a.authentication.user&&d.path("/"),a.askForPasswordReset=function(){a.success=a.error=null,c.post("/auth/forgot",a.credentials).success(function(b){a.credentials=null,a.success=b.message}).error(function(b){a.credentials=null,a.error=b.message})},a.resetUserPassword=function(){a.success=a.error=null,c.post("/auth/reset/"+b.token,a.passwordDetails).success(function(b){a.passwordDetails=null,e.user=b,d.path("/password/reset/success")}).error(function(b){a.error=b.message})}}]),angular.module("users").controller("SettingsController",["$scope","$http","$location","Users","Authentication",function(a,b,c,d,e){a.user=e.user,a.user||c.path("/"),a.hasConnectedAdditionalSocialAccounts=function(b){for(var c in a.user.additionalProvidersData)return!0;return!1},a.isConnectedSocialAccount=function(b){return a.user.provider===b||a.user.additionalProvidersData&&a.user.additionalProvidersData[b]},a.removeUserSocialAccount=function(c){a.success=a.error=null,b["delete"]("/users/accounts",{params:{provider:c}}).success(function(b){a.success=!0,a.user=e.user=b}).error(function(b){a.error=b.message})},a.updateUserProfile=function(b){if(b){a.success=a.error=null;var c=new d(a.user);c.$update(function(b){a.success=!0,e.user=b},function(b){a.error=b.data.message})}else a.submitted=!0},a.changeUserPassword=function(){a.success=a.error=null,b.post("/users/password",a.passwordDetails).success(function(b){a.success=!0,a.passwordDetails=null}).error(function(b){a.error=b.message})}}]),angular.module("users").factory("Authentication",[function(){var a=this;return a._data={user:window.user},a._data}]),angular.module("users").factory("Users",["$resource",function(a){return a("users",{},{update:{method:"PUT"}})}]);